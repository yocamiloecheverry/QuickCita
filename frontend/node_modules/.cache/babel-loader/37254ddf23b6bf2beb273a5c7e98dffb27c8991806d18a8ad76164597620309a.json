{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dae01\\\\Documents\\\\Universidad\\\\QuickCita\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useReducer } from \"react\";\nimport { loginUser, logoutUser } from \"../services/authService\";\nimport { jwtDecode } from \"jwt-decode\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isAuthenticated: !!localStorage.getItem(\"token\"),\n  user: null\n};\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case \"LOGIN_SUCCESS\":\n      return {\n        ...state,\n        isAuthenticated: true,\n        user: action.payload\n      };\n    case \"LOGOUT\":\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: null\n      };\n    default:\n      return state;\n  }\n};\nexport const AuthContext = /*#__PURE__*/createContext(initialState);\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [state, dispatch] = useReducer(authReducer, initialState);\n  const handleLogin = async credentials => {\n    try {\n      const {\n        token\n      } = await loginUser(credentials);\n      localStorage.setItem(\"token\", token);\n\n      // Decodificamos el JWT para extraer id_usuario y rol\n      const decoded = jwtDecode(token);\n      const id_usuario = decoded.id_usuario;\n      const perfilResponse = await api.get(`/usuarios/profile/${id_usuario}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const perfil = perfilResponse.data;\n      console.log(decoded);\n      // decoded tiene { id_usuario, rol, iat, exp }\n      dispatch({\n        type: \"LOGIN_SUCCESS\",\n        payload: decoded\n      });\n      return decoded; // Retornamos el usuario decodificado\n    } catch (err) {\n      console.error(\"Error al iniciar sesión:\", err);\n      throw err;\n    }\n  };\n  const handleLogout = () => {\n    logoutUser();\n    dispatch({\n      type: \"LOGOUT\"\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      ...state,\n      handleLogin,\n      handleLogout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"6JWkGZ32UPfojeNx+xqn8ZU8A0Q=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useReducer","loginUser","logoutUser","jwtDecode","jsxDEV","_jsxDEV","initialState","isAuthenticated","localStorage","getItem","user","authReducer","state","action","type","payload","AuthContext","AuthProvider","children","_s","dispatch","handleLogin","credentials","token","setItem","decoded","id_usuario","perfilResponse","api","get","headers","Authorization","perfil","data","console","log","err","error","handleLogout","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/dae01/Documents/Universidad/QuickCita/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useReducer } from \"react\";\r\nimport { loginUser, logoutUser } from \"../services/authService\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\n\r\nconst initialState = {\r\n  isAuthenticated: !!localStorage.getItem(\"token\"),\r\n  user: null,\r\n};\r\n\r\nconst authReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case \"LOGIN_SUCCESS\":\r\n      return { ...state, isAuthenticated: true, user: action.payload };\r\n    case \"LOGOUT\":\r\n      return { ...state, isAuthenticated: false, user: null };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const AuthContext = createContext(initialState);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  const handleLogin = async (credentials) => {\r\n    try {\r\n      const { token } = await loginUser(credentials);\r\n      localStorage.setItem(\"token\", token);\r\n\r\n      // Decodificamos el JWT para extraer id_usuario y rol\r\n      const decoded = jwtDecode(token);\r\n      const id_usuario = decoded.id_usuario;\r\n\r\n      const perfilResponse = await api.get(`/usuarios/profile/${id_usuario}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      \r\n      const perfil = perfilResponse.data;\r\n\r\n      console.log(decoded);\r\n      // decoded tiene { id_usuario, rol, iat, exp }\r\n      dispatch({ type: \"LOGIN_SUCCESS\", payload: decoded });\r\n      return decoded; // Retornamos el usuario decodificado\r\n    } catch (err) {\r\n      console.error(\"Error al iniciar sesión:\", err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    logoutUser();\r\n    dispatch({ type: \"LOGOUT\" });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ ...state, handleLogin, handleLogout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,QAAQ,OAAO;AACxD,SAASC,SAAS,EAAEC,UAAU,QAAQ,yBAAyB;AAC/D,SAASC,SAAS,QAAQ,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEvC,MAAMC,YAAY,GAAG;EACnBC,eAAe,EAAE,CAAC,CAACC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAChDC,IAAI,EAAE;AACR,CAAC;AAED,MAAMC,WAAW,GAAGA,CAACC,KAAK,EAAEC,MAAM,KAAK;EACrC,QAAQA,MAAM,CAACC,IAAI;IACjB,KAAK,eAAe;MAClB,OAAO;QAAE,GAAGF,KAAK;QAAEL,eAAe,EAAE,IAAI;QAAEG,IAAI,EAAEG,MAAM,CAACE;MAAQ,CAAC;IAClE,KAAK,QAAQ;MACX,OAAO;QAAE,GAAGH,KAAK;QAAEL,eAAe,EAAE,KAAK;QAAEG,IAAI,EAAE;MAAK,CAAC;IACzD;MACE,OAAOE,KAAK;EAChB;AACF,CAAC;AAED,OAAO,MAAMI,WAAW,gBAAGjB,aAAa,CAACO,YAAY,CAAC;AAEtD,OAAO,MAAMW,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC5C,MAAM,CAACP,KAAK,EAAEQ,QAAQ,CAAC,GAAGpB,UAAU,CAACW,WAAW,EAAEL,YAAY,CAAC;EAE/D,MAAMe,WAAW,GAAG,MAAOC,WAAW,IAAK;IACzC,IAAI;MACF,MAAM;QAAEC;MAAM,CAAC,GAAG,MAAMtB,SAAS,CAACqB,WAAW,CAAC;MAC9Cd,YAAY,CAACgB,OAAO,CAAC,OAAO,EAAED,KAAK,CAAC;;MAEpC;MACA,MAAME,OAAO,GAAGtB,SAAS,CAACoB,KAAK,CAAC;MAChC,MAAMG,UAAU,GAAGD,OAAO,CAACC,UAAU;MAErC,MAAMC,cAAc,GAAG,MAAMC,GAAG,CAACC,GAAG,CAAC,qBAAqBH,UAAU,EAAE,EAAE;QACtEI,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUR,KAAK;QAAG;MAC9C,CAAC,CAAC;MAEF,MAAMS,MAAM,GAAGL,cAAc,CAACM,IAAI;MAElCC,OAAO,CAACC,GAAG,CAACV,OAAO,CAAC;MACpB;MACAL,QAAQ,CAAC;QAAEN,IAAI,EAAE,eAAe;QAAEC,OAAO,EAAEU;MAAQ,CAAC,CAAC;MACrD,OAAOA,OAAO,CAAC,CAAC;IAClB,CAAC,CAAC,OAAOW,GAAG,EAAE;MACZF,OAAO,CAACG,KAAK,CAAC,0BAA0B,EAAED,GAAG,CAAC;MAC9C,MAAMA,GAAG;IACX;EACF,CAAC;EAED,MAAME,YAAY,GAAGA,CAAA,KAAM;IACzBpC,UAAU,CAAC,CAAC;IACZkB,QAAQ,CAAC;MAAEN,IAAI,EAAE;IAAS,CAAC,CAAC;EAC9B,CAAC;EAED,oBACET,OAAA,CAACW,WAAW,CAACuB,QAAQ;IAACC,KAAK,EAAE;MAAE,GAAG5B,KAAK;MAAES,WAAW;MAAEiB;IAAa,CAAE;IAAApB,QAAA,EAClEA;EAAQ;IAAAuB,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACW,CAAC;AAE3B,CAAC;AAACzB,EAAA,CAtCWF,YAAY;AAAA4B,EAAA,GAAZ5B,YAAY;AAAA,IAAA4B,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}